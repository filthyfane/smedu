{% extends 'base.nav.html.twig' %}

{% block title %}Administrare {{ role }}{% endblock %}

{% block body %}
  <h2 class="coinyFont">Administrare {{ role }}</h2>
  <br>
  {% if users %}
    <table id="users" class="table table-striped table-hover">

      <thead id="users_table_head">
        <tr>
          <th>Nume, Prenume</th>
          <th>
            {% if role == 'Elevi' %}
              Clasă
            {% else %}
              E-mail
            {% endif %}
          </th>
          <th>Nivel Acces</th>
          <th></th>
        </tr>
      </thead>

      <tbody id="users_table">
        {% for user in users %}
          {# DO NOT display root user if imported from fixtures (useful for prod)#}
          {% if user.getUsername != "root" %}
          <tr id="users_row">
            <td><a href="{{ path('user_show', {'id':user.id}) }}"><i class="fas fa-eye"></i>&nbsp{{ user.getFullName(1) }}</a></td>
            {% if user.getUsertype == 'ROLE_PARENT' %}
            <td><a href="#"><i class="far fa-envelope reset-user" data-id="{{ user.id }}" style="font-size:25px"></i></a> {{ user.email }}</td>
            {% elseif user.getUsertype == 'ROLE_PUPIL' %}
            <td>{{ user.getChildLatestEnroll.getStudent.getClassGroup.getGroupName|default('-') }}</td>
            {% else %}
            <td>{{ user.email }}</td>
            {% endif %}
            <td>{{ user.getNormalized }}</td>
            <td>
              <a href="{{ path('user_edit', {'id':user.id}) }}"><button type="button" class="btn-sm btn-primary">Editează</button></a>
              {% if app.user.username != user.username and user.usertype != 'ROLE_PUPIL' and user.usertype != 'ROLE_PARENT' %}
                <a href="#"><button type="button" class="btn-sm btn-danger delete-user" data-id="{{ user.id }}">Șterge</button></a>
              {% endif %}
            </td>
          </tr>
          {% endif %}
        {% endfor %}

      </tbody>

    </table>
  {% else %}
    <p>No users found in DB</p>
  {% endif %}

{% endblock %}

{% block javascripts %}
  <script src="/js/user_reset.js"></script>
  <script src="/js/user_delete.js"></script>
  <script>
    ScrollReveal({ reset: true }).reveal('#users', { duration:2000, delay:0 });
    ScrollReveal({ reset: true }).reveal('#users_table_head', { duration:800, delay:0 });
    ScrollReveal({ reset: true }).reveal('#users_row', { duration:1000, delay:0 });
  </script>
{% endblock %}
